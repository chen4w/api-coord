---
title: 异步请求
date: 2021-11-23 16:41:03
permalink: /pages/92470c/
---

# 异步请求

## 异步接口描述

<ClientOnly><Swagger-SwaggerShow></Swagger-SwaggerShow></ClientOnly>

## 一、异步单次请求

> 异步调用具体说明参考[HTTP异步请求概述](/pages/7c927c/)

### 1. 调用方代码

:::tip

异步请求时，必须在`ReqOption`对象中，设置`callBackUrl`和`callBackMethod`两个参数。

此处两个参数用于告诉服务方的中间件，具体的应答接口几应答接口的类型。

:::

```java

// 构建请求参数
        Map<String, Object> map = new HashMap<>(1);
        map.put("pageSize", 1);
        map.put("pageNo", 10);
        // 设置请求配置对象
        ReqOption option = new ReqOption();
        // 设置为异步请求
        option.setSync(ReqOption.FALSE);
        // 设置异步请求应答接口地址
        option.setCallbackUrl("/callback");
        // 设置异步请求接口应答地址请求类型
        option.setCallbackMethod(HttpType.GET.toString());
        // 发送请求，并获取返回结果
        InterCoResult result = MiddlewareClient
                // 填写中间件地址及端口号，及超时时间
                .create("http://localhost:8888", 50000)
                // 请求类型，根据接口定义设置
                .setHttpType(HttpType.GET)
                // 中间件中的服务id，根据yml文件配置填写
                .setServiceId("1")
                // 设置访问的url
                .setUrl("/user/async")
                // 设置传输的数据
                .setForm(map)
                // 发送数据
                .msg(option);
```
### 2. 服务方代码

:::tip

1. 服务方在应答时需要知道请求id。
2. 请求id会随着参数一起传如接口，使用`request.getParameter("cid")`可接收到请求id。
3. 此处代码示例展示的为服务方应答时的代码示例。

:::

```java
        // 从数据库获取调用方请求的数据
        List<Map<String, Object>> list = baseMapper.selectAll("table_name",pageSize,pageNo);
        // 构建请求参数
        Map<String, Object> map = new HashMap<>(1);
        map.put("data", list);
        // 传输设置
        ReqOption reqOption = new ReqOption();
        // 设置为应答
        reqOption.setBReq(ReqOption.FALSE);
        // 设置为异步请求
        reqOption.setSync(ReqOption.FALSE);
        // 设置cid，此处的cid为请求id，会随着服务方的调用一起跟着参数传过来
        reqOption.setCid(cid);
        // 发送请求，并获取返回结果
        InterCoResult result = MiddlewareClient
            // 填写中间件地址及端口号，及超时时间（毫秒），地址及端口号填写配置文件中 middleware-recServer 下的配置
            .create("http://localhost:8888", 50000)
            // 设置传输的数据
            .setForm(map)
            // 发送数据
            .msg(reqOption);

```

## 二、异步多次请求

> 异步多次请求，可以参考[同步多次请求](/pages/1c5b20/#二、同步多次请求)，就是将异步单次操作进行多次调用。

:::warning

1. 异步多次请求参考同步请求时，需要设置请求为异步（sync=false），同时需要设置应答接口url(callbackUrl)及应答接口类型(CallbackMethod)。
2. 如果多次请求的应答接口均为同一个，则推荐将请求ID（cid）也设置为同一个。
3. 如果多次请求的应答接口为不同，则请求（cid）一定要设置成**不同**的。（可不设置cid，客户端会自动每次生成不同的id）

:::

## 三、异步上传文件

## 四、异步下载文件
