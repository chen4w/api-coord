---
title: gRPC请求存证
date: 2021-10-22 17:30:09
permalink: /pages/932973/
---

# gRPC 请求存证

!!! tip "提示"

    推荐使用[接入中间件](/mid/)进行接口存证，可大大减少用户代码量。



## 一、概述

>  本项目主要参考了专利《一种可举证的接口协同方法及系统》的S3部分并实现了其中的样例。
>
> 代码地址：[https://gitee.com/BTAJL/api-coord](https://gitee.com/BTAJL/api-coord)

## 二、主要流程

该样例主要内容和流程为：

* 请求方将请求的目标账户集合分多次发送给服务端，服务方对请求内容签名并返回给请求方，请求方将本次交互的内容进行存证；

* 服务方将请求方请求的目标账户对应的交易历史集合分多次应答给请求端，请求方对应答内容签名并返回给服务方，服务方将本次交互的内容进行存证。

## 三、过程的调用及存证过程时序图

![ro](/img/grpc-description.png)

* 图中前三次交互对应上小节的第一步，后三次交互对应上小节的第二步；

* rb、ri、re为请求方请求，rb为起始接口请求、ri为中间接口请求（可多次）、re为结束接口请求；

* cb、ci、ce为服务方应答，cb为起始接口应答、ci为中间接口应答（可多次）、ce为结束接口应答;

* 每次交互的第二步Signature为针对接收到内容的签名；

* 每次交互的第三步接口调用存证为将本次交互存证；

## 四、接口定义

接口定义采用protobuf,包含了双方请求应答的全部参数定义和调用方法的定义，具体内容可参考专利 《一种可举证的接口协同方法及系统》或代码 `src/main/proto/apicoord.proto`。

## 五、启动

首先分别启动请求方和服务方的服务端，即运行：

* `src/main/java/examples/apicoord/request/TranQueryCallbackServer.java`的`main`;

* `src/main/java/examples/apicoord/server/TfanQueryServer.java`的`main`。

最后启动请求方的的客户端，即运行：

* `src/main/java/examples/apicoord/request/TranQueryClient.java`的`main`。

## 六、代码结构

代码结构请点击[此处](/pages/5536f8/#二、grpc调用代码示例结构)查看。

